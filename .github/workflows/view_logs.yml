name: Deploy

on:
  push:
  workflow_dispatch:

jobs:
  evaluate:
    runs-on: ubuntu-latest
    outputs:
      proceed: ${{ steps.set-proceed.outputs.proceed }}
    steps:
      - name: Set proceed flag
        id: set-proceed
        run: |
          echo "proceed=true" >> "$GITHUB_OUTPUT"

  deploy:
    runs-on: ubuntu-latest
    needs: evaluate
    if: needs.evaluate.outputs.proceed == 'true'
    steps:
      - name: ðŸš€ Auto Deploy
        run: echo "Auto deploy since proceed is true."

  approve:
    runs-on: ubuntu-latest
    needs: evaluate
    if: needs.evaluate.outputs.proceed == 'false'
    environment:
      name: manual-approval
    steps:
      - name: âœ… Approved manually
        run: echo "Approved manually"

  deploy_after_approval:
    runs-on: ubuntu-latest
    needs: approve
    if: needs.evaluate.outputs.proceed == 'false' && needs.approve.result == 'success'
    steps:
      - name: ðŸš€ Deploy after approval
        run: echo "Deploying after manual approval."
