name: üîç View Logs from EC2

on:
  push:
    branches:
      - View-Logs-Functionality
  workflow_dispatch:

jobs:
  view-logs:
    runs-on: ubuntu-latest

    steps:
      - name: üßæ Checkout code
        uses: actions/checkout@v3

      - name: üîê Save private key to file
        run: |
          printf '%s\n' "${{ secrets.PRIVATE_KEY }}" > private_key.pem
          chmod 600 private_key.pem

      - name: üß† Debug secrets (optional)
        run: |
          echo "üë§ EC2_USER: $EC2_USER"
          echo "üåê EC2_HOST: $EC2_HOST"
          echo "üìÑ LOG_PATH: $LOG_PATH"
        env:
          EC2_USER: ${{ secrets.EC2_USER }}
          EC2_HOST: ${{ secrets.EC2_HOST }}
          LOG_PATH: ${{ secrets.LOG_PATH }}

      - name: üì° SSH into EC2 and view logs
        run: |
          echo "Running: ssh -i private_key.pem $EC2_USER@$EC2_HOST 'tail -n 25 $LOG_PATH'"
          ssh -o StrictHostKeyChecking=no -i private_key.pem $EC2_USER@$EC2_HOST "tail -n 25 '$LOG_PATH'" || {
            echo "‚ùå SSH failed. Check key format, user, or permissions."; exit 1;
          }
        env:
          EC2_USER: ${{ secrets.EC2_USER }}
          EC2_HOST: ${{ secrets.EC2_HOST }}
          LOG_PATH: ${{ secrets.LOG_PATH }}

